<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.6.1/lodash.min.js"></script>
    <style>
      * {
        padding: 0;
        margin: 0;
      }
      li {
        list-style: none;
      }
      body {
        font-family: sans-serif;
        padding: 40px 30px;
        color: #555;
      }
      h2 {
        font-size: 24px;
        font-weight: normal;
      }
      h3 {
        margin-bottom: 15px;
        font-size: 14px;
        text-transform: uppercase;
      }
      .row {
        padding: 20px;
        background: #f6f6f6;
        margin-bottom: 10px;
      }
      .content {
        display: flex;
        width: 100%;
      }

      .col {
        padding: 0 10px;
        flex: 1;
      }

      .event-header {
        display: flex;
        margin-bottom: 20px;
      }
      .event-image {
        width: 80px;
        height: 120px;
        background: #eee;
        margin-right: 10px;
      }
      .event-id {
        font-size: 12px;
        margin-bottom: 5px;
      }
      .event-date {
        margin-top: 10px;
      }
      .event-users li {
        margin-bottom: 5px;
        padding: 5px 10px;
        background: #fff;
      }
      .event-winner {
        margin-top: 10px;
        font-size: 13px;
      }
      .event-winner .name {
        font-weight: bold;
      }


      .user-info {
        position: relative;
      }
      .user-win-ratio {
        position: absolute;
        top: 0;
        right: 0;
      }
    </style>
  </head>
  <body>
  </body>



<script type="text/jsx">
"use strict";

const usersList = [{
  "id": "0001",
  "name": "Phil"
},{
  "id": "0002",
  "name": "Tully"
},{
  "id": "0003",
  "name": "Dom"
},{
  "id": "0004",
  "name": "Kelv"
}]

const eventsList = [{
  "id": "0001",
  "gameName": "Splendor",
  "players": ["0001", "0003"],
  "winner": "0003"
},{
  "id": "0002",
  "gameName": "Machi Koro",
  "players": ["0001", "0002", "0003"],
  "winner": "0002"
},{
  "id": "0003",
  "gameName": "Splendor",
  "players": ["0004", "0002", "0003", "0001"],
  "winner": "0002"
},{
  "id": "0004",
  "gameName": "Splendor",
  "players": ["0002", "0001"],
  "winner": "0001"
},{
  "id": "0005",
  "gameName": "Colt Express",
  "players": ["0002", "0001", "0004"],
  "winner": "0002"
},{
  "id": "0006",
  "gameName": "Colt Express",
  "players": ["0001", "0003", "0004"],
  "winner": "0003"
},{
  "id": "0007",
  "gameName": "Colt Express",
  "players": ["0001", "0003", "0004", "0002"],
  "winner": "0003"
}];



const Content = React.createClass({

  // Cross reference an event's winner id with all users to get the winner name
  renderWinner(event) {
    const winnerName = usersList.map(winner => {
      if (winner.id === event.winner) {
        return winner.name;
      }
    });
    return winnerName;
  },

  renderEventPlayers(event) {
    let eventPlayers = [];
    usersList.map(user => {
      if (event.players.includes(user.id)) {
        eventPlayers.push(user.name);
      }
    });
    return eventPlayers;
  },

  // Simply render all the events highlighting the winner
  renderEvents() {
    const events = eventsList.map(event => {
      const displayEventUsers = this.renderEventPlayers(event).map(player => {
        return <li>
          {player}
        </li>
      });
      return <div className="row">
        <div className="event-header">
          <div className="event-image"></div>
          <div className="event-info">
            <div className="event-id">{event.id}</div>
            <h2>{event.gameName}</h2>
            <div className="event-date">Date: </div>
          </div>
        </div>
        <h3>Players:</h3>
        <ul className="event-users">
          {displayEventUsers}
        </ul>
        <div className="event-winner">Winner: <span className="name">{this.renderWinner(event)}</span></div>
      </div>
    });
    return events
  },

  // Which events a user has won
  userWins(user) {
    let wins = [];
    eventsList.map(event => {
      if (event.winner === user.id) {
        wins.push(event.gameName);
      }
    });
    return wins;
  },

  // Which events a user has played
  userEvents(user) {
    let eventsPlayed = [];
    eventsList.map(event => {
      if (event.players.includes(user.id)) {
        eventsPlayed.push(event.gameName);
      }
    });
    return eventsPlayed;
  },

  // Get user's most successful event
  userBestEvent(user) {

    const list = this.userWins(user);

    // const xs = list.reduce((a, b, i, array) => {
    //   const find = _.find(a, ['name', array[i]]);
    //   if (find) {
    //     find.count += 1;
    //     return a;
    //   } else {
    //     return a.concat({name: array[i], count: 1})
    //   }
    // }, []);

    const counts = list.reduce((acc,x,i) => {
      if (acc.length === 0) {
        acc.push({name: "", count: 0})
      }
      if (acc[i].name === x) {
        acc[i].count += 1;
      } else {
        acc.push({name: x, count: 1})
      }
      return acc;
    }, []);

    const output = counts.reduce((acc,x) => {
      if (acc.length === 0) {
        acc.push(x)
      } else if (acc[0].count < x.count) {
        acc = [x];
      } else if (acc[0].count === x.count) {
        acc.push(x);
      }
      return acc;
    }, [])

    return output;
  },

  // Calculate percentage win ratio of a user
  userWinRatio(user) {
    return Math.round(this.userWins(user).length / this.userEvents(user).length * 100 * 10) / 10;
  },

  // Render a user's stats
  renderUser(user) {
    let game = this.userBestEvent(user).map(val => {
      return `${val.name} (${val.count}) `;
    });
    if (this.userBestEvent(user).length === 0) {
      game = "No wins yet"
    }
    return <div className="row">
      <div className="user-info">
        <h2>{user.name}</h2>
        <div className="user-win-ratio">{this.userWinRatio(user)}%</div>
        <div className="user-wins">Won {this.userWins(user).length} of {this.userEvents(user).length}</div>
        <div className="user-most-won">Most wins in: {game}</div>
        <div className="user-nemesis">Nemesis: </div>
      </div>
    </div>
  },

  // Render the users in order of users in descending order of win ratio
  renderLeaderboard() {
    const output = usersList.sort((a,b) => {
      return this.userWinRatio(b) - this.userWinRatio(a);
    }).map((user) => {
      return <div>
        {this.renderUser(user)}
      </div>
    })
    return output;
  },

  // Show me the money
  render() {
    return <div className="content">
      <div className="col">
        {this.renderEvents()}
      </div>
      <div className="col">
        {this.renderLeaderboard()}
      </div>
    </div>
  }

});





const element = React.createElement(Content);
React.render(element, document.body);
</script>
</html>





--------------------







"use strict";

var React = require('react');

var NewEventPlayer = React.createClass({
    getInitialState: function() {
        return { values: [
            {type: "translateX", x: 10},
            {type: "scaleX", x: 1.2}
        ]}
    },
    handleTypeChange: function(i, value) {
        this.state.values[i].type = value
        this.setState({ values: this.state.values })
    },
    render: function() {
        return <div>
            {this.state.values.map(function(item, i) {
                var typeLink = {
                    value: this.state.values[i].type,
                    requestChange: this.handleTypeChange.bind(null, i)
                }
                return <div className={i}>
                    <input valueLink={typeLink}/>
                    <input value={this.state.values[i].x}/>
                </div>
            }, this)}
        </div>;
    }
});

module.exports = NewEventPlayer;
